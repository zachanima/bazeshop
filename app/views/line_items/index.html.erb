<%= content_tag :div, class: :cart do %>
  <table>
    <thead>
      <tr>
        <th colspan="9">Kurv</th>
    </thead>
    <tbody>
      <% current_user.line_items.current.each do |line_item| %>
        <tr>
          <td><%= line_item.product_name %></td>
          <td><%= line_item.product_number %></td>
          <td>
            <% line_item.variations.each do |variation| %>
              <%= variation.option_set_name %>: <%= variation.option_name %>
              <%= "(+ #{number_to_smart_currency variation.gross_price, @shop.currency})" if variation.gross_price %>
              <br>
            <% end %>
          </td>
          <td><%= number_to_smart_currency line_item.product_gross_price, @shop.currency if line_item.product_gross_price %></td>
          <td class="action"><%= button_to '-', decrement_shop_line_item_path(@shop, line_item), method: :put %></td>
          <td class="number"><%= line_item.quantity %> stk.</td>
          <td class="action"><%= button_to '+', increment_shop_line_item_path(@shop, line_item), method: :put %></td>
          <td class="action"><%= button_to 'Slet', shop_line_item_path(@shop, line_item), method: :delete %></td>
          <td class="number">
            <%= number_to_smart_currency line_item.gross_price, @shop.currency if line_item.gross_price %>
          </td>
        </tr>
      <% end %>
      <tr>
        <th colspan="8">Total</th>
        <th class="number">
          <%= number_to_smart_currency current_user.line_items.current.collect(&:gross_price).compact.inject(&:+), @shop.currency %>
        </th>
      </tr>
    </tbody>
  </table>
<% end unless current_user.line_items.current.count == 0 %>

<% if @shop.reject_order_on_exceeded_budget and current_user.balance - current_user.line_items.current.collect(&:gross_price).compact.inject(&:+) < 0 %>
  <strong>Denne ordre kan ikke afgives, da den vil overskride dit budget.</strong>

<% else %>
  <%= form_for [@shop, @order] do |f| %>
    <div class="fields">
      <%= f.label :comment, 'Kommentar' %>
      <%= f.text_area :comment %>
    </div>

    <div class="submit">
      <%= f.submit 'Afgiv bestilling' %>
    </div>
  <% end unless current_user.line_items.current.count == 0 %>
<% end %>

<%= content_tag :div do %>
  <p>Der er ingen varer i kurven.</p>
<% end if current_user.line_items.current.count == 0 %>
